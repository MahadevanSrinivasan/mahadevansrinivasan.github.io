(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{238:(e,t,s)=>{"use strict";s.d(t,{default:()=>eQ});var a=s(5155),r=s(2115),n=s(4301),l=s(7607),i=s(469),d=s(1920),o=s(4253),c=s(2085),u=s(9434);let m=(0,c.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),f=r.forwardRef((e,t)=>{let{className:s,variant:r,size:n,asChild:l=!1,...i}=e,d=l?o.DX:"button";return(0,a.jsx)(d,{className:(0,u.cn)(m({variant:r,size:n,className:s})),ref:t,...i})});f.displayName="Button";var x=s(3425);let p=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,u.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...r})});p.displayName="Card";let h=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,u.cn)("flex flex-col space-y-1.5 p-6",s),...r})});h.displayName="CardHeader";let g=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,u.cn)("text-2xl font-semibold leading-none tracking-tight",s),...r})});g.displayName="CardTitle";let y=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,u.cn)("text-sm text-muted-foreground",s),...r})});y.displayName="CardDescription";let v=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,u.cn)("p-6 pt-0",s),...r})});v.displayName="CardContent";let j=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,u.cn)("flex items-center p-6 pt-0",s),...r})});j.displayName="CardFooter";var N=s(5863);let b=r.forwardRef((e,t)=>{let{className:s,value:r,...n}=e;return(0,a.jsx)(N.bL,{ref:t,className:(0,u.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...n,children:(0,a.jsx)(N.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})});b.displayName=N.bL.displayName;let w=(0,c.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function S(e){let{className:t,variant:s,...r}=e;return(0,a.jsx)("div",{className:(0,u.cn)(w({variant:s}),t),...r})}var C=s(2278);let A=C.bL,I=C.l9,D=C.ZL,R=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(C.hJ,{className:(0,u.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r,ref:t})});R.displayName=C.hJ.displayName;let E=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsxs)(D,{children:[(0,a.jsx)(R,{}),(0,a.jsx)(C.UC,{ref:t,className:(0,u.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...r})]})});E.displayName=C.UC.displayName;let O=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,u.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...s})};O.displayName="AlertDialogHeader";let k=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,u.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};k.displayName="AlertDialogFooter";let P=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(C.hE,{ref:t,className:(0,u.cn)("text-lg font-semibold",s),...r})});P.displayName=C.hE.displayName;let _=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(C.VY,{ref:t,className:(0,u.cn)("text-sm text-muted-foreground",s),...r})});_.displayName=C.VY.displayName;let F=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(C.rc,{ref:t,className:(0,u.cn)(m(),s),...r})});F.displayName=C.rc.displayName;let L=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(C.ZD,{ref:t,className:(0,u.cn)(m({variant:"outline"}),"mt-2 sm:mt-0",s),...r})});L.displayName=C.ZD.displayName;var M=s(965),T=s(3158),U=s(638);function z(e){let{className:t,classNames:s,showOutsideDays:r=!0,...n}=e;return(0,a.jsx)(U.hv,{showOutsideDays:r,className:(0,u.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,u.cn)(m({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,u.cn)(m({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...s},components:{IconLeft:e=>{let{className:t,...s}=e;return(0,a.jsx)(M.A,{className:(0,u.cn)("h-4 w-4",t),...s})},IconRight:e=>{let{className:t,...s}=e;return(0,a.jsx)(T.A,{className:(0,u.cn)("h-4 w-4",t),...s})}},...n})}z.displayName="Calendar";var J=s(518),Y=s(8390),G=s(7223),H=s(3013);function V(e){let{expense:t}=e,{logOccurrence:s,logPayment:n,deleteExpense:l,getBalances:i,eventLogs:d}=(0,x.F)(),[o,c]=(0,r.useState)(new Date),u=d.some(e=>e.expenseId===t.id&&"payment"===e.type),{totalPaid:m,totalUsed:N,remaining:w}=i(t.id),C=u&&m>0?w/m*100:0,D=u&&w<=0;return(0,a.jsxs)(p,{className:"flex flex-col transition-all hover:shadow-lg",children:[(0,a.jsx)(h,{children:(0,a.jsxs)("div",{className:"flex justify-between items-start gap-2",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(g,{className:"font-headline",children:t.name}),(0,a.jsxs)(y,{children:[t.totalOccurrences," uses per payment"]})]}),D&&(0,a.jsx)(S,{variant:"destructive",className:"animate-pulse",children:"Payment Due"})]})}),(0,a.jsx)(v,{className:"flex-grow",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm text-muted-foreground",children:[(0,a.jsx)("span",{children:"Remaining"}),(0,a.jsxs)("span",{className:"font-semibold text-foreground",children:[u?w>0?w:0:"N/A"," / ",u?m:"N/A"]})]}),(0,a.jsx)(b,{value:C>0?C:0}),u?(0,a.jsxs)("p",{className:"text-xs text-muted-foreground pt-1",children:["Used ",N," time",1!==N?"s":""," in total."]}):(0,a.jsx)("p",{className:"text-xs text-muted-foreground pt-1",children:"Log a payment to start tracking."})]})}),(0,a.jsxs)(j,{className:"flex gap-2 justify-between",children:[(0,a.jsxs)(A,{children:[(0,a.jsx)(I,{asChild:!0,children:(0,a.jsxs)(f,{variant:"outline",className:"flex-1",disabled:!u,children:[(0,a.jsx)(J.A,{className:"mr-2 h-4 w-4"})," Log Use"]})}),(0,a.jsxs)(E,{children:[(0,a.jsxs)(O,{children:[(0,a.jsxs)(P,{children:['Log Usage for "',t.name,'"']}),(0,a.jsx)(_,{children:"Select the date for this usage log. It will default to today."})]}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(z,{mode:"single",selected:o,onSelect:c,className:"rounded-md border"})}),(0,a.jsxs)(k,{children:[(0,a.jsx)(L,{children:"Cancel"}),(0,a.jsxs)(F,{onClick:()=>{o&&s(t.id,o)},disabled:!o,children:["Log Use for ",o?(0,H.GP)(o,"PPP"):""]})]})]})]}),(0,a.jsxs)(A,{children:[(0,a.jsx)(I,{asChild:!0,children:(0,a.jsxs)(f,{className:"flex-1",children:[(0,a.jsx)(Y.A,{className:"mr-2 h-4 w-4"})," Log Payment"]})}),(0,a.jsxs)(E,{children:[(0,a.jsxs)(O,{children:[(0,a.jsxs)(P,{children:['Log Payment for "',t.name,'"']}),(0,a.jsxs)(_,{children:["This will add ",t.totalOccurrences," uses to your balance. Select the date of the payment."]})]}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(z,{mode:"single",selected:o,onSelect:c,className:"rounded-md border"})}),(0,a.jsxs)(k,{children:[(0,a.jsx)(L,{children:"Cancel"}),(0,a.jsxs)(F,{onClick:()=>{o&&n(t.id,o)},disabled:!o,children:["Log Payment for ",o?(0,H.GP)(o,"PPP"):""]})]})]})]}),(0,a.jsxs)(A,{children:[(0,a.jsx)(I,{asChild:!0,children:(0,a.jsx)(f,{variant:"ghost",size:"icon","aria-label":"Delete expense",children:(0,a.jsx)(G.A,{className:"h-4 w-4 text-muted-foreground"})})}),(0,a.jsxs)(E,{children:[(0,a.jsxs)(O,{children:[(0,a.jsx)(P,{children:"Are you absolutely sure?"}),(0,a.jsxs)(_,{children:['This action cannot be undone. This will permanently delete the "',t.name,'" expense and all its history.']})]}),(0,a.jsxs)(k,{children:[(0,a.jsx)(L,{children:"Cancel"}),(0,a.jsx)(F,{onClick:()=>l(t.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})]})]})]})}var B=s(2177),W=s(221),Z=s(5594),X=s(968);let q=(0,c.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),K=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(X.b,{ref:t,className:(0,u.cn)(q(),s),...r})});K.displayName=X.b.displayName;let Q=B.Op,$=r.createContext({}),ee=e=>{let{...t}=e;return(0,a.jsx)($.Provider,{value:{name:t.name},children:(0,a.jsx)(B.xI,{...t})})},et=()=>{let e=r.useContext($),t=r.useContext(es),{getFieldState:s,formState:a}=(0,B.xW)(),n=s(e.name,a);if(!e)throw Error("useFormField should be used within <FormField>");let{id:l}=t;return{id:l,name:e.name,formItemId:"".concat(l,"-form-item"),formDescriptionId:"".concat(l,"-form-item-description"),formMessageId:"".concat(l,"-form-item-message"),...n}},es=r.createContext({}),ea=r.forwardRef((e,t)=>{let{className:s,...n}=e,l=r.useId();return(0,a.jsx)(es.Provider,{value:{id:l},children:(0,a.jsx)("div",{ref:t,className:(0,u.cn)("space-y-2",s),...n})})});ea.displayName="FormItem";let er=r.forwardRef((e,t)=>{let{className:s,...r}=e,{error:n,formItemId:l}=et();return(0,a.jsx)(K,{ref:t,className:(0,u.cn)(n&&"text-destructive",s),htmlFor:l,...r})});er.displayName="FormLabel";let en=r.forwardRef((e,t)=>{let{...s}=e,{error:r,formItemId:n,formDescriptionId:l,formMessageId:i}=et();return(0,a.jsx)(o.DX,{ref:t,id:n,"aria-describedby":r?"".concat(l," ").concat(i):"".concat(l),"aria-invalid":!!r,...s})});en.displayName="FormControl",r.forwardRef((e,t)=>{let{className:s,...r}=e,{formDescriptionId:n}=et();return(0,a.jsx)("p",{ref:t,id:n,className:(0,u.cn)("text-sm text-muted-foreground",s),...r})}).displayName="FormDescription";let el=r.forwardRef((e,t)=>{var s;let{className:r,children:n,...l}=e,{error:i,formMessageId:d}=et(),o=i?String(null!=(s=null==i?void 0:i.message)?s:""):n;return o?(0,a.jsx)("p",{ref:t,id:d,className:(0,u.cn)("text-sm font-medium text-destructive",r),...l,children:o}):null});el.displayName="FormMessage";let ei=r.forwardRef((e,t)=>{let{className:s,type:r,...n}=e;return(0,a.jsx)("input",{type:r,className:(0,u.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...n})});ei.displayName="Input";let ed=Z.Ik({name:Z.Yj().min(2,{message:"Expense name must be at least 2 characters."}),totalOccurrences:Z.au.number().min(1,{message:"Total occurrences must be at least 1."})});function eo(e){let{setOpen:t}=e,{addExpense:s}=(0,x.F)(),r=(0,B.mN)({resolver:(0,W.u)(ed),defaultValues:{name:"",totalOccurrences:10}});return(0,a.jsx)(Q,{...r,children:(0,a.jsxs)("form",{onSubmit:r.handleSubmit(function(e){s(e),r.reset(),t(!1)}),className:"space-y-8 py-4",children:[(0,a.jsx)(ee,{control:r.control,name:"name",render:e=>{let{field:t}=e;return(0,a.jsxs)(ea,{children:[(0,a.jsx)(er,{children:"Expense Name"}),(0,a.jsx)(en,{children:(0,a.jsx)(ei,{placeholder:"e.g. Weekly Coffee",...t})}),(0,a.jsx)(el,{})]})}}),(0,a.jsx)(ee,{control:r.control,name:"totalOccurrences",render:e=>{let{field:t}=e;return(0,a.jsxs)(ea,{children:[(0,a.jsx)(er,{children:"Occurrences per Cycle"}),(0,a.jsx)(en,{children:(0,a.jsx)(ei,{type:"number",placeholder:"e.g. 10",...t})}),(0,a.jsx)(el,{})]})}}),(0,a.jsx)(f,{type:"submit",className:"w-full",children:"Create Expense"})]})})}var ec=s(3520),eu=s(9340);function em(e){let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,u.cn)("animate-pulse rounded-md bg-muted",t),...s})}function ef(){let{eventLogs:e,expenses:t,isLoading:s,deleteEventLog:n}=(0,x.F)(),[l,i]=(0,r.useState)(new Date),[d,o]=(0,r.useState)(new Date),c=e.filter(e=>"occurrence"===e.type).map(e=>new Date(e.date)),u=e.filter(e=>"payment"===e.type).map(e=>new Date(e.date)),m=(0,r.useMemo)(()=>e.filter(e=>(0,ec.t)(new Date(e.date),d)).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),[e,d]),y=e=>{var s;return(null==(s=t.find(t=>t.id===e))?void 0:s.name)||"Unknown Expense"};return s?(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-8",children:[(0,a.jsx)(em,{className:"rounded-md border h-[375px]"}),(0,a.jsxs)(p,{children:[(0,a.jsx)(h,{children:(0,a.jsx)(em,{className:"h-6 w-1/2"})}),(0,a.jsxs)(v,{className:"space-y-4",children:[(0,a.jsx)(em,{className:"h-12 w-full"}),(0,a.jsx)(em,{className:"h-12 w-full"}),(0,a.jsx)(em,{className:"h-12 w-full"})]})]})]}):(0,a.jsxs)("div",{className:"grid lg:grid-cols-2 gap-8 items-start",children:[(0,a.jsx)(z,{mode:"single",selected:l,onSelect:e=>{i(e),e&&o(e)},month:d,onMonthChange:o,className:"rounded-md border self-start",modifiers:{occurrences:c,payments:u},modifiersClassNames:{occurrences:"day-occurrence",payments:"day-payment"},components:{DayContent:e=>{let t=c.some(t=>(0,eu.r)(t,e.date)),s=u.some(t=>(0,eu.r)(t,e.date));return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(U.CZ,{...e}),(t||s)&&(0,a.jsxs)("div",{className:"absolute bottom-1 left-1/2 -translate-x-1/2 flex gap-1",children:[t&&(0,a.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-primary"}),s&&(0,a.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-accent"})]})]})}}}),(0,a.jsxs)(p,{children:[(0,a.jsx)(h,{children:(0,a.jsxs)(g,{className:"font-headline",children:["Events for ",(0,H.GP)(d,"MMMM yyyy")]})}),(0,a.jsxs)(v,{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4 text-sm mb-6 border-b pb-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"h-3 w-3 rounded-full bg-primary"}),(0,a.jsx)("span",{children:"Usage"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"h-3 w-3 rounded-full bg-accent"}),(0,a.jsx)("span",{children:"Payment"})]})]}),m.length>0?(0,a.jsx)("ul",{className:"space-y-2 max-h-[400px] overflow-y-auto pr-2",children:m.map(e=>(0,a.jsxs)("li",{className:"flex items-center justify-between gap-4 p-2 rounded-md hover:bg-muted/50",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:["occurrence"===e.type?(0,a.jsx)("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-primary/10 text-primary",children:(0,a.jsx)(J.A,{className:"h-5 w-5"})}):(0,a.jsx)("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-accent text-accent-foreground",children:(0,a.jsx)(Y.A,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold",children:y(e.expenseId)}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["occurrence"===e.type?"Usage logged":"Payment logged"," on ",(0,H.GP)(new Date(e.date),"MMM d, p")]})]})]}),(0,a.jsxs)(A,{children:[(0,a.jsx)(I,{asChild:!0,children:(0,a.jsx)(f,{variant:"ghost",size:"icon","aria-label":"Delete event",children:(0,a.jsx)(G.A,{className:"h-4 w-4 text-muted-foreground hover:text-destructive"})})}),(0,a.jsxs)(E,{children:[(0,a.jsxs)(O,{children:[(0,a.jsx)(P,{children:"Are you sure you want to delete this event?"}),(0,a.jsx)(_,{children:"This action cannot be undone. This will permanently delete this event log entry."})]}),(0,a.jsxs)(k,{children:[(0,a.jsx)(L,{children:"Cancel"}),(0,a.jsx)(F,{onClick:()=>n(e.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})]})]},e.id))}):(0,a.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"No events for this month."})]})]})]})}function ex(e){return(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...e,children:[(0,a.jsx)("path",{d:"M8 7V5c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2v2"}),(0,a.jsx)("path",{d:"M12 11h4"}),(0,a.jsx)("path",{d:"M12 16h4"}),(0,a.jsx)("path",{d:"M8 11h.01"}),(0,a.jsx)("path",{d:"M8 16h.01"}),(0,a.jsx)("path",{d:"M4 7h16"}),(0,a.jsx)("rect",{width:"18",height:"14",x:"3",y:"7",rx:"2"})]})}var ep=s(9179),eh=s(4404),eg=s(154);let ey=eh.bL,ev=eh.l9;eh.YJ,eh.ZL,eh.Pb,eh.z6,r.forwardRef((e,t)=>{let{className:s,inset:r,children:n,...l}=e;return(0,a.jsxs)(eh.ZP,{ref:t,className:(0,u.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",s),...l,children:[n,(0,a.jsx)(T.A,{className:"ml-auto"})]})}).displayName=eh.ZP.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(eh.G5,{ref:t,className:(0,u.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...r})}).displayName=eh.G5.displayName;let ej=r.forwardRef((e,t)=>{let{className:s,sideOffset:r=4,...n}=e;return(0,a.jsx)(eh.ZL,{children:(0,a.jsx)(eh.UC,{ref:t,sideOffset:r,className:(0,u.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...n})})});ej.displayName=eh.UC.displayName;let eN=r.forwardRef((e,t)=>{let{className:s,inset:r,...n}=e;return(0,a.jsx)(eh.q7,{ref:t,className:(0,u.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",s),...n})});eN.displayName=eh.q7.displayName,r.forwardRef((e,t)=>{let{className:s,children:r,checked:n,...l}=e;return(0,a.jsxs)(eh.H_,{ref:t,className:(0,u.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:n,...l,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(eh.VF,{children:(0,a.jsx)(J.A,{className:"h-4 w-4"})})}),r]})}).displayName=eh.H_.displayName,r.forwardRef((e,t)=>{let{className:s,children:r,...n}=e;return(0,a.jsxs)(eh.hN,{ref:t,className:(0,u.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...n,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(eh.VF,{children:(0,a.jsx)(eg.A,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=eh.hN.displayName;let eb=r.forwardRef((e,t)=>{let{className:s,inset:r,...n}=e;return(0,a.jsx)(eh.JU,{ref:t,className:(0,u.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",s),...n})});eb.displayName=eh.JU.displayName;let ew=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(eh.wv,{ref:t,className:(0,u.cn)("-mx-1 my-1 h-px bg-muted",s),...r})});ew.displayName=eh.wv.displayName;var eS=s(5977);let eC=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(eS.bL,{ref:t,className:(0,u.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...r})});eC.displayName=eS.bL.displayName;let eA=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(eS._V,{ref:t,className:(0,u.cn)("aspect-square h-full w-full",s),...r})});eA.displayName=eS._V.displayName;let eI=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(eS.H4,{ref:t,className:(0,u.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...r})});eI.displayName=eS.H4.displayName;var eD=s(172),eR=s(3349),eE=s(6104),eO=s(5317),ek=s(7481);let eP=()=>{let e=localStorage.getItem("prepaid-expenses")||"[]",t=localStorage.getItem("prepaid-events")||"[]",s=[],a=[];try{s=JSON.parse(e)}catch(e){console.error("Failed to parse local expenses",e)}try{a=JSON.parse(t)}catch(e){console.error("Failed to parse local events",e)}return{localExpenses:s,localEvents:a}},e_=()=>{let{currentUser:e}=(0,ep.J)(),{reload:t}=(0,x.F)(),[s,a]=(0,r.useState)(!1);return{syncData:(0,r.useCallback)(async function(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!e||e.isAnonymous){r||(0,ek.oR)({title:"Sync Failed",description:"You must be signed in with a Google account to sync data.",variant:"destructive"});return}if(!s){a(!0),r||(0,ek.oR)({title:"Syncing started...",description:"Please wait while we sync your data."}),console.log("SYNC: Starting sync process for user:",e.id);try{let{localExpenses:s,localEvents:a}=eP(),n=s.filter(t=>t.userId===e.id),l=new Set(n.map(e=>e.id)),i=a.filter(e=>l.has(e.expenseId));console.log("SYNC: Found ".concat(n.length," local expenses and ").concat(i.length," local events for the current user.")),r||(0,ek.oR)({title:"Step 1/4: Fetching cloud data..."}),console.log("SYNC: STAGE 1 - Fetching remote data...");let d=(0,eO.P)((0,eO.rJ)(eE.db,"expenses"),(0,eO._M)("userId","==",e.id)),o=await (0,eO.GG)(d),c=new Map(o.docs.map(e=>{let t=e.data(),s=t.lastUpdatedAt instanceof eO.Dc?t.lastUpdatedAt.toDate().toISOString():t.lastUpdatedAt;return[e.id,{...t,id:e.id,lastUpdatedAt:s,userId:t.userId}]})),u=Array.from(c.keys()),m=new Map;if(u.length>0){let e=[];for(let t=0;t<u.length;t+=30){let s=u.slice(t,t+30),a=(0,eO.P)((0,eO.rJ)(eE.db,"eventLogs"),(0,eO._M)("expenseId","in",s));e.push((0,eO.GG)(a))}(await Promise.all(e)).forEach(e=>{e.docs.forEach(e=>{let t=e.data(),s=t.date instanceof eO.Dc?t.date.toDate().toISOString():t.date;m.set(e.id,{...t,id:e.id,date:s,userId:t.userId})})})}console.log("SYNC: Fetched ".concat(c.size," remote expenses and ").concat(m.size," remote events.")),r||(0,ek.oR)({title:"Step 2/4: Syncing expenses..."}),console.log("SYNC: STAGE 2 - Preparing expense batch...");let f=(0,eO.wP)(eE.db),x=new Map;c.forEach(e=>x.set(e.id,e)),n.forEach(e=>{let t=c.get(e.id);if(e.isDeleted)t&&(console.log("SYNC: Deleting expense ".concat(e.id)),f.delete((0,eO.H9)(eE.db,"expenses",e.id))),x.delete(e.id);else{let s=new Date(e.lastUpdatedAt).getTime(),a=t?new Date(t.lastUpdatedAt).getTime():0;if(s>=a){console.log("SYNC: Adding/updating expense ".concat(e.id," in batch."));let{id:t,name:s,totalOccurrences:a,userId:r,lastUpdatedAt:n}=e,l={name:s,totalOccurrences:a,userId:r,lastUpdatedAt:eO.Dc.fromDate(new Date(n))};f.set((0,eO.H9)(eE.db,"expenses",t),l)}let{isDeleted:r,...n}=e;x.set(e.id,n)}}),console.log("SYNC: Committing expense batch..."),r||(0,ek.oR)({title:"Step 2/4: Saving expenses to cloud..."}),await f.commit(),console.log("SYNC: Expense batch committed successfully."),r||(0,ek.oR)({title:"Step 3/4: Syncing event history..."}),console.log("SYNC: STAGE 3 - Preparing event log batch...");let p=(0,eO.wP)(eE.db),h=new Map;m.forEach(e=>h.set(e.id,e)),i.forEach(e=>{if(!x.has(e.expenseId))return void console.log("SYNC: Skipping event ".concat(e.id," as parent expense is deleted."));if(e.isDeleted)m.has(e.id)&&(console.log("SYNC: Deleting event ".concat(e.id)),p.delete((0,eO.H9)(eE.db,"eventLogs",e.id))),h.delete(e.id);else{if(!m.has(e.id)){console.log("SYNC: Adding new event ".concat(e.id," to batch."));let{id:t,expenseId:s,type:a,date:r,userId:n}=e;p.set((0,eO.H9)(eE.db,"eventLogs",t),{expenseId:s,type:a,date:eO.Dc.fromDate(new Date(r)),userId:n})}let{isDeleted:t,...s}=e;h.set(e.id,s)}}),console.log("SYNC: Committing event log batch..."),r||(0,ek.oR)({title:"Step 3/4: Saving event history to cloud..."}),await p.commit(),console.log("SYNC: Event log batch committed successfully."),r||(0,ek.oR)({title:"Step 4/4: Finalizing sync..."}),console.log("SYNC: STAGE 4 - Updating local storage...");let g=s.filter(t=>t.userId!==e.id&&!t.isDeleted),y=new Set(g.map(e=>e.id)),v=a.filter(e=>y.has(e.expenseId)&&!e.isDeleted),j=[...g,...Array.from(x.values())],N=[...v,...Array.from(h.values())];localStorage.setItem("prepaid-expenses",JSON.stringify(j)),localStorage.setItem("prepaid-events",JSON.stringify(N)),console.log("SYNC: Local storage updated."),t(),r||(0,ek.oR)({title:"Sync Successful!",description:"Your data is up to date."}),console.log("SYNC: Sync process completed successfully.")}catch(t){console.error("Sync failed:",t);let e=t instanceof Error?t.message:"An unknown error occurred.";r||(0,ek.oR)({title:"Sync Failed",description:"An error occurred: ".concat(e),variant:"destructive"})}finally{a(!1)}}},[e,t,s]),isSyncing:s}},eF=()=>(0,a.jsxs)("svg",{className:"h-4 w-4",viewBox:"0 0 24 24",children:[(0,a.jsx)("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),(0,a.jsx)("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),(0,a.jsx)("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),(0,a.jsx)("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"}),(0,a.jsx)("path",{d:"M1 1h22v22H1z",fill:"none"})]});function eL(){let{currentUser:e,isLoading:t,signInWithGoogle:s,logOut:r}=(0,ep.J)(),{syncData:n,isSyncing:l}=e_(),i=async()=>{e&&!e.isAnonymous&&await n(),await r()};return t||l?(0,a.jsx)(f,{variant:"outline",size:"icon",disabled:!0,children:(0,a.jsx)(eD.A,{className:"h-4 w-4 animate-spin"})}):!e||e.isAnonymous?(0,a.jsxs)(f,{onClick:s,children:[(0,a.jsx)(eF,{}),"Sign in with Google"]}):(0,a.jsxs)(ey,{children:[(0,a.jsx)(ev,{asChild:!0,children:(0,a.jsx)(f,{variant:"ghost",className:"relative h-8 w-8 rounded-full",children:(0,a.jsxs)(eC,{className:"h-8 w-8",children:[(0,a.jsx)(eA,{src:e.avatar,alt:e.name,"data-ai-hint":"avatar"}),(0,a.jsx)(eI,{children:e.name.charAt(0)})]})})}),(0,a.jsxs)(ej,{className:"w-56",align:"end",forceMount:!0,children:[(0,a.jsx)(eb,{className:"font-normal",children:(0,a.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium leading-none",children:e.name}),(0,a.jsx)("p",{className:"text-xs leading-none text-muted-foreground",children:"Signed In"})]})}),(0,a.jsx)(ew,{}),(0,a.jsxs)(eN,{onClick:i,children:[(0,a.jsx)(eR.A,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Log out"})]})]})]})}var eM=s(5821),eT=s(5318);let eU=eM.bL,ez=eM.l9,eJ=eM.ZL;eM.bm;let eY=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(eM.hJ,{ref:t,className:(0,u.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r})});eY.displayName=eM.hJ.displayName;let eG=r.forwardRef((e,t)=>{let{className:s,children:r,...n}=e;return(0,a.jsxs)(eJ,{children:[(0,a.jsx)(eY,{}),(0,a.jsxs)(eM.UC,{ref:t,className:(0,u.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...n,children:[r,(0,a.jsxs)(eM.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(eT.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});eG.displayName=eM.UC.displayName;let eH=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,u.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};eH.displayName="DialogHeader";let eV=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(eM.hE,{ref:t,className:(0,u.cn)("text-lg font-semibold leading-none tracking-tight",s),...r})});eV.displayName=eM.hE.displayName;let eB=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(eM.VY,{ref:t,className:(0,u.cn)("text-sm text-muted-foreground",s),...r})});eB.displayName=eM.VY.displayName;var eW=s(704);let eZ=eW.bL,eX=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(eW.B8,{ref:t,className:(0,u.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...r})});eX.displayName=eW.B8.displayName;let eq=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(eW.l9,{ref:t,className:(0,u.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...r})});eq.displayName=eW.l9.displayName;let eK=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(eW.UC,{ref:t,className:(0,u.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...r})});function eQ(){let{expenses:e,isLoading:t,reload:s,migrateGuestData:o}=(0,x.F)(),{currentUser:c,isLoading:u,guestDataToMerge:m,setGuestDataToMerge:h}=(0,ep.J)(),{syncData:g,isSyncing:y}=e_(),[j,N]=(0,r.useState)(!1);(0,r.useEffect)(()=>{s()},[c,s]),(0,r.useEffect)(()=>{let e=()=>{c&&!c.isAnonymous&&g(!0)};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[c,g]);let b=async()=>{m&&c&&(await o(m,c.id),h(null),await g())};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(eU,{open:j,onOpenChange:N,children:[(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsxs)("header",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-8",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(ex,{className:"h-8 w-8 text-primary"}),(0,a.jsx)("h1",{className:"text-3xl font-bold font-headline",children:"Prepaid Tracker"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(eL,{}),(0,a.jsxs)(f,{onClick:()=>g(),disabled:y||!c||c.isAnonymous,variant:"outline",children:[(0,a.jsx)(l.A,{className:"mr-2 h-4 w-4"}),y?"Syncing...":"Sync"]}),(0,a.jsx)(ez,{asChild:!0,children:(0,a.jsxs)(f,{children:[(0,a.jsx)(n.A,{className:"mr-2 h-4 w-4"})," Add Expense"]})})]})]}),(null==c?void 0:c.isAnonymous)&&(0,a.jsx)(p,{className:"mb-6 bg-secondary border-secondary-foreground/10",children:(0,a.jsx)(v,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex-grow",children:[(0,a.jsx)("h3",{className:"font-semibold",children:"You are in Guest Mode"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Sign in with your Google account to save your expenses to the cloud and sync across devices."})]}),(0,a.jsx)(eL,{})]})})}),(0,a.jsxs)(eZ,{defaultValue:"dashboard",className:"w-full",children:[(0,a.jsxs)(eX,{className:"mb-6 grid w-full grid-cols-2 md:w-[400px]",children:[(0,a.jsxs)(eq,{value:"dashboard",children:[(0,a.jsx)(i.A,{className:"mr-2 h-4 w-4"}),"Dashboard"]}),(0,a.jsxs)(eq,{value:"calendar",children:[(0,a.jsx)(d.A,{className:"mr-2 h-4 w-4"}),"Calendar"]})]}),(0,a.jsx)(eK,{value:"dashboard",children:t||u?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[void 0,void 0,void 0].map((e,t)=>(0,a.jsxs)(p,{className:"p-6 space-y-4",children:[(0,a.jsx)(em,{className:"h-6 w-3/4"}),(0,a.jsx)(em,{className:"h-4 w-1/2"}),(0,a.jsxs)("div",{className:"space-y-2 pt-4",children:[(0,a.jsx)(em,{className:"h-4 w-full"}),(0,a.jsx)(em,{className:"h-10 w-full"})]})]},t))}):0===e.length?(0,a.jsxs)("div",{className:"text-center py-16 border-2 border-dashed rounded-lg",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold",children:"No expenses yet!"}),(0,a.jsx)("p",{className:"text-muted-foreground mt-2",children:"Get started by adding your first prepaid expense."}),(0,a.jsx)(ez,{asChild:!0,children:(0,a.jsxs)(f,{className:"mt-6",children:[(0,a.jsx)(n.A,{className:"mr-2 h-4 w-4"})," Add New Expense"]})})]}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:e.map(e=>(0,a.jsx)(V,{expense:e},e.id))})}),(0,a.jsx)(eK,{value:"calendar",children:(0,a.jsx)(ef,{})})]})]}),(0,a.jsxs)(eG,{className:"sm:max-w-[425px]",children:[(0,a.jsxs)(eH,{children:[(0,a.jsx)(eV,{children:"Add a New Prepaid Expense"}),(0,a.jsx)(eB,{children:"Configure a new recurring prepaid expense to track its usage."})]}),(0,a.jsx)(eo,{setOpen:N})]})]}),(0,a.jsx)(A,{open:!!m,children:(0,a.jsxs)(E,{children:[(0,a.jsxs)(O,{children:[(0,a.jsx)(P,{children:"Merge Guest Data?"}),(0,a.jsx)(_,{children:"We found some data you created as a guest. Would you like to merge it into your new account?"})]}),(0,a.jsxs)(k,{children:[(0,a.jsx)(L,{onClick:()=>h(null),children:"Don't Merge"}),(0,a.jsx)(F,{onClick:b,children:"Merge Data"})]})]})})]})}eK.displayName=eW.UC.displayName},3425:(e,t,s)=>{"use strict";s.d(t,{ExpensesProvider:()=>m,F:()=>f});var a=s(5155),r=s(2115),n=s(7481),l=s(9179),i=s(5317),d=s(6104);let o="prepaid-expenses",c="prepaid-events",u=(0,r.createContext)(void 0),m=e=>{let{children:t}=e,{currentUser:s}=(0,l.J)(),[m,f]=(0,r.useState)([]),[x,p]=(0,r.useState)([]),[h,g]=(0,r.useState)(!0),y=(0,r.useCallback)(()=>{g(!0);try{let e=localStorage.getItem(o),t=e?JSON.parse(e):[],a=localStorage.getItem(c),r=a?JSON.parse(a):[],n=t.filter(e=>!e.isDeleted),l=r.filter(e=>!e.isDeleted);if(s){let e=n.filter(e=>e.userId===s.id),t=new Set(e.map(e=>e.id)),a=l.filter(e=>t.has(e.expenseId));f(e),p(a)}else f([]),p([])}catch(e){console.error("Failed to load data from localStorage",e),(0,n.oR)({title:"Error",description:"Could not load your data.",variant:"destructive"})}finally{g(!1)}},[s]);(0,r.useEffect)(()=>{y()},[y]);let v=(0,r.useCallback)(e=>{let{expenses:t,eventLogs:s}=e;try{localStorage.setItem(o,JSON.stringify(t)),localStorage.setItem(c,JSON.stringify(s)),y()}catch(e){console.error("Failed to set data in localStorage",e),(0,n.oR)({title:"Error",description:"Could not save synced data.",variant:"destructive"})}},[y]),j=(e,t)=>{try{let s=JSON.parse(localStorage.getItem(e)||"[]");if(Array.isArray(t)){let a=new Set(t.map(e=>e.id)),r=s.filter(e=>!a.has(e.id));localStorage.setItem(e,JSON.stringify([...r,...t]))}else{let a=s.findIndex(e=>e.id===t.id);a>-1?t.isDeleted?(s[a].isDeleted=!0,s[a].lastUpdatedAt=new Date().toISOString()):s[a]=t:s.push(t),localStorage.setItem(e,JSON.stringify(s))}}catch(t){console.error("Failed to update ".concat(e," in localStorage"),t)}},N=e=>{let t=JSON.parse(localStorage.getItem(o)||"[]"),s=t.findIndex(t=>t.id===e);s>-1&&(t[s].lastUpdatedAt=new Date().toISOString(),localStorage.setItem(o,JSON.stringify(t)),f(t=>t.map(t=>t.id===e?{...t,lastUpdatedAt:new Date().toISOString()}:t)))},b=(e,t,a)=>{if(!s)return void(0,n.oR)({title:"Not logged in",description:"Cannot log event without a user.",variant:"destructive"});if(!m.find(t=>t.id===e))return;let r={id:(0,i.H9)((0,i.rJ)(d.db,"eventLogs")).id,expenseId:e,userId:s.id,type:t,date:a.toISOString()};return p(e=>[r,...e].sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime())),j(c,r),N(e),r},w=(0,r.useCallback)(e=>{let t=m.find(t=>t.id===e);if(!t)return{totalPaid:0,totalUsed:0,remaining:0};let s=x.filter(t=>t.expenseId===e),a=s.filter(e=>"payment"===e.type).reduce(e=>e+t.totalOccurrences,0),r=s.filter(e=>"occurrence"===e.type).length;return{totalPaid:a,totalUsed:r,remaining:a-r}},[x,m]),S=async(e,t)=>{g(!0);try{console.log("Migrating data from ".concat(e," to ").concat(t));let s=JSON.parse(localStorage.getItem(o)||"[]"),a=JSON.parse(localStorage.getItem(c)||"[]"),r=s.map(s=>s.userId===e?(console.log("- Migrating expense: ".concat(s.name)),{...s,userId:t,lastUpdatedAt:new Date().toISOString()}):s),l=a.map(s=>s.userId===e?{...s,userId:t}:s);localStorage.setItem(o,JSON.stringify(r)),localStorage.setItem(c,JSON.stringify(l)),y(),(0,n.oR)({title:"Data Merged",description:"Your guest data has been successfully merged."})}catch(e){console.error("Failed to migrate guest data",e),(0,n.oR)({title:"Error",description:"Could not migrate guest data.",variant:"destructive"})}finally{g(!1)}};return(0,a.jsx)(u.Provider,{value:{expenses:m,eventLogs:x,addExpense:e=>{if(!s)return void(0,n.oR)({title:"Not logged in",description:"You must be logged in to add an expense.",variant:"destructive"});let t=(0,i.H9)((0,i.rJ)(d.db,"expenses")).id,a={...e,id:t,userId:s.id,lastUpdatedAt:new Date().toISOString()};f(e=>[...e,a]),j(o,a),(0,n.oR)({title:"Expense Added",description:'"'.concat(a.name,'" has been created. Sync with the cloud to save it.')})},deleteExpense:e=>{let t=m.find(t=>t.id===e);t&&s&&(j(o,{...t,isDeleted:!0}),x.filter(t=>t.expenseId===e).forEach(e=>j(c,{...e,isDeleted:!0})),f(t=>t.filter(t=>t.id!==e)),p(t=>t.filter(t=>t.expenseId!==e)),(0,n.oR)({title:"Expense Deleted",description:"The expense and its history have been removed locally. Sync with cloud to finalize."}))},logOccurrence:(e,t)=>{let s=m.find(t=>t.id===e);if(s){if(!x.some(t=>t.expenseId===e&&"payment"===t.type))return void(0,n.oR)({title:"Payment Required",description:"Please log a payment before logging usage.",variant:"destructive"});b(e,"occurrence",t)&&(0,n.oR)({title:"Usage Logged",description:'Logged a use for "'.concat(null==s?void 0:s.name,'".')})}},logPayment:(e,t)=>{let s=m.find(t=>t.id===e);s&&b(e,"payment",t)&&(0,n.oR)({title:"Payment Logged",description:'Logged a payment for "'.concat(null==s?void 0:s.name,'". ').concat(s.totalOccurrences," uses have been added.")})},getBalances:w,isLoading:h,setAllData:v,reload:y,deleteEventLog:e=>{let t=x.find(t=>t.id===e);t&&s&&(j(c,{...t,isDeleted:!0}),p(t=>t.filter(t=>t.id!==e)),N(t.expenseId),(0,n.oR)({title:"Event Deleted",description:"The event has been removed locally. Sync to save changes."}))},migrateGuestData:S},children:t})},f=()=>{let e=(0,r.useContext)(u);if(void 0===e)throw Error("useExpenses must be used within an ExpensesProvider");return e}},6104:(e,t,s)=>{"use strict";s.d(t,{db:()=>i,j:()=>d});var a=s(3915),r=s(5317),n=s(3004);let l=(0,a.Wp)({apiKey:"AIzaSyA2l7y9oLU644TzBr7avoInnc1CLm3VHu4",authDomain:"recurringexpensetracker-54a02.firebaseapp.com",projectId:"recurringexpensetracker-54a02",storageBucket:"recurringexpensetracker-54a02.appspot.com",messagingSenderId:"119730529214",appId:"1:119730529214:web:42b39db4c61aceecde4fef",measurementId:"G-674DFWNBPX"}),i=(0,r.aU)(l),d=(0,n.xI)(l)},7481:(e,t,s)=>{"use strict";s.d(t,{dj:()=>m,oR:()=>u});var a=s(2115);let r=0,n=new Map,l=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},i=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?l(s):e.toasts.forEach(e=>{l(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},d=[],o={toasts:[]};function c(e){o=i(o,e),d.forEach(e=>{e(o)})}function u(e){let{...t}=e,s=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>c({type:"DISMISS_TOAST",toastId:s});return c({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||a()}}}),{id:s,dismiss:a,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function m(){let[e,t]=a.useState(o);return a.useEffect(()=>(d.push(t),()=>{let e=d.indexOf(t);e>-1&&d.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}},8688:(e,t,s)=>{Promise.resolve().then(s.bind(s,238)),Promise.resolve().then(s.bind(s,3425)),Promise.resolve().then(s.bind(s,9179))},9179:(e,t,s)=>{"use strict";s.d(t,{J:()=>u,UserProvider:()=>c});var a=s(5155),r=s(2115),n=s(6104),l=s(3004),i=s(5317),d=s(7481);let o=(0,r.createContext)(void 0),c=e=>{let{children:t}=e,[s,c]=(0,r.useState)(null),[u,m]=(0,r.useState)(!0),[f,x]=(0,r.useState)(null),p=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=(0,l.hg)(n.j,async e=>{if(m(!0),e){var t;if((null==(t=p.current)?void 0:t.isAnonymous)&&!e.isAnonymous){let e=p.current.uid;JSON.parse(localStorage.getItem("prepaid-expenses")||"[]").some(t=>t.id===e)&&x(e)}let s=(0,i.H9)(n.db,"users",e.uid),a=await (0,i.x7)(s);if(a.exists())c({id:a.id,...a.data()});else if(e.isAnonymous){let t={id:e.uid,name:"Anonymous Guest",avatar:"https://placehold.co/100x100.png",isAnonymous:!0};await (0,i.BN)(s,{name:t.name,isAnonymous:!0,createdAt:(0,i.O5)()}),c(t)}else{let t={id:e.uid,name:e.displayName||"Google User",avatar:e.photoURL||"https://placehold.co/100x100.png",isAnonymous:!1};await (0,i.BN)(s,{name:t.name,avatar:t.avatar,email:e.email,isAnonymous:!1,createdAt:(0,i.O5)()}),c(t)}}else(0,l.zK)(n.j).catch(e=>console.error("Auto anonymous sign-in failed",e));p.current=e,m(!1)});return()=>e()},[]);let h=async()=>{let e=new l.HF;try{m(!0);let t=(await (0,l.df)(n.j,e)).user,s=(0,i.H9)(n.db,"users",t.uid),a=await (0,i.x7)(s);if(a.exists())c({id:a.id,...a.data()}),(0,d.oR)({title:"Welcome back!",description:"You have successfully signed in."});else{let e={id:t.uid,name:t.displayName||"Google User",avatar:t.photoURL||"https://placehold.co/100x100.png",isAnonymous:!1};await (0,i.BN)(s,{name:e.name,avatar:e.avatar,email:t.email,isAnonymous:!1,createdAt:(0,i.O5)()}),c(e),(0,d.oR)({title:"Welcome!",description:"Your account has been created."})}}catch(e){console.error("Google sign-in failed",e),(0,d.oR)({title:"Sign-in Failed",description:"Could not sign you in with Google. Please try again.",variant:"destructive"})}finally{m(!1)}},g=async()=>{try{await (0,l.CI)(n.j),c(null),(0,d.oR)({title:"Signed Out",description:"You have been successfully signed out."}),await (0,l.zK)(n.j)}catch(e){console.error("Sign-out failed",e),(0,d.oR)({title:"Sign-out Failed",description:"Could not sign you out. Please try again.",variant:"destructive"})}};return(0,a.jsx)(o.Provider,{value:{currentUser:s,isLoading:u,signInWithGoogle:h,logOut:g,guestDataToMerge:f,setGuestDataToMerge:x},children:t})},u=()=>{let e=(0,r.useContext)(o);if(void 0===e)throw Error("useUser must be used within a UserProvider");return e}},9434:(e,t,s)=>{"use strict";s.d(t,{cn:()=>n});var a=s(2596),r=s(9688);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.QP)((0,a.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[416,992,222,960,441,684,358],()=>t(8688)),_N_E=e.O()}]);